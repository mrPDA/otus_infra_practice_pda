# –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è Spark –∫–ª–∞—Å—Ç–µ—Ä–∞ –≤ Yandex Cloud

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Terraform –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Spark –∫–ª–∞—Å—Ç–µ—Ä–∞ –≤ Yandex Cloud Data Proc —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫ –¥–∞–Ω–Ω—ã–º.

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ create_spark/        # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Spark –∫–ª–∞—Å—Ç–µ—Ä–∞
‚îú‚îÄ‚îÄ create-bucket/       # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ S3 –±–∞–∫–µ—Ç–∞ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
‚îî‚îÄ‚îÄ create-admin-sa/     # –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π)
```

## üöÄ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

1. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone <repository-url>
cd otus-practice-cloud-infra
```



2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ `.env`:
   - –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç–∏ –∫ SSH –∫–ª—é—á–∞–º
   - –î–æ–±–∞–≤—å—Ç–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –æ–±–ª–∞–∫–∞ –∏ –ø–∞–ø–∫–∏
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ—Å—Ç—É–ø—ã –∫ S3

4. –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –∏ –ø–æ–ª—É—á–∏—Ç–µ –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞:


5. –°–æ–∑–¥–∞–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä:
```bash
cd create_spark
source .env
terraform init
terraform apply
```

## üîã –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ Spark –∫–ª–∞—Å—Ç–µ—Ä–∞
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NAT –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≥—Ä—É–ø–ø—ã –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Object Storage
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

## üõ† –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞

- –ú–∞—Å—Ç–µ—Ä-—É–∑–µ–ª: s3-c2-m8, 40 –ì–ë SSD
- –î–∞—Ç–∞-—É–∑–ª—ã: 3√ó s3-c4-m16, 128 –ì–ë SSD
- –°–µ—Ç—å: –í—ã–¥–µ–ª–µ–Ω–Ω–∞—è –ø–æ–¥—Å–µ—Ç—å —Å NAT
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –º–∞—Å—Ç–µ—Ä-—É–∑–ª—É:
```bash
ssh ubuntu@<master-node-ip>
```

–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ S3:
```bash
hadoop distcp \
  -D fs.s3a.access.key=YOUR_ACCESS_KEY \
  -D fs.s3a.secret.key=YOUR_SECRET_KEY \
  -D fs.s3a.endpoint=storage.yandexcloud.net \
  s3a://your-bucket/* \
  hdfs:///user/ubuntu/data/
```

```bash
ssh -o StrictHostKeyChecking=no ubuntu@rc1a-dataproc-m-****_fv.mdb.yandexcloud.net "hadoop distcp \
  -D fs.s3a.access.key=$TF_VAR_s3_access_key \
  -D fs.s3a.secret.key=$TF_VAR_s3_secret_key \
  -D fs.s3a.endpoint=storage.yandexcloud.net \
  -D dfs.replication=1 \
  -D dfs.blocksize=128m \
  -D mapreduce.job.maps=10 \
  -D mapreduce.map.memory.mb=2048 \
  -D mapreduce.map.java.opts=-Xmx1536m \
  -D dfs.client.use.datanode.hostname=true \
  -update -log /tmp/distcp_log \
  s3a://$TF_VAR_bucket_name/* \
  hdfs:///user/ubuntu/data/"
```

–†–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
![copy_rez](https://github.com/user-attachments/assets/4bf55f96-71f7-4fb9-ada8-4240830eaac7)

## üßπ –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤

–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤:
```bash
cd create_spark
terraform destroy
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `.env` (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ git)
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
- –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –≥—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

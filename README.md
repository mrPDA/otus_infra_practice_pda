# –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è Spark –∫–ª–∞—Å—Ç–µ—Ä–∞ –≤ Yandex Cloud

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Terraform –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Spark –∫–ª–∞—Å—Ç–µ—Ä–∞ –≤ Yandex Cloud Data Proc —Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∫ –¥–∞–Ω–Ω—ã–º.

–ê–¥—Ä–µ—Å –±–∞–∫–µ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ s3a://otus-copy-b1gjj3po03aa3m4j8ps5/

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ create_spark/        # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Spark –∫–ª–∞—Å—Ç–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ main.tf         # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ variables.tf    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ outputs.tf      # –í—ã—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ create-bucket/      # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ S3 –±–∞–∫–µ—Ç–∞ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ main.tf         # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è S3 bucket
‚îÇ   ‚îî‚îÄ‚îÄ s3-sync-proxy/  # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∫—Å–∏ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ create-admin-sa/    # –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
    ‚îî‚îÄ‚îÄ create-key.sh   # –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–µ–π
```

## üöÄ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Terraform
- –ê–∫–∫–∞—É–Ω—Ç –≤ Yandex Cloud
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π CLI Yandex Cloud
- SSH –∫–ª—é—á–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/yourusername/otus-practice-cloud-infra.git
cd otus-practice-cloud-infra
```

2. –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –∏ –ø–æ–ª—É—á–∏—Ç–µ –∫–ª—é—á–∏:

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω

4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ :
   - YC_TOKEN - —Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Yandex Cloud
   - YC_CLOUD_ID - ID –æ–±–ª–∞–∫–∞
   - YC_FOLDER_ID - ID –ø–∞–ø–∫–∏
   - TF_VAR_s3_access_key - –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞ –∫ S3
   - TF_VAR_s3_secret_key - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á S3

### –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

1. –°–æ–∑–¥–∞–π—Ç–µ S3 –±–∞–∫–µ—Ç –¥–ª—è –¥–∞–Ω–Ω—ã—Ö:
```bash
cd create-bucket
terraform init
terraform apply
cd ..
```

2. –°–æ–∑–¥–∞–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä:
```bash
cd create_spark
terraform init
terraform apply
```

## üõ† –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞

### –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —É–∑–ª–æ–≤
- –ú–∞—Å—Ç–µ—Ä-—É–∑–µ–ª: s3-c2-m8 (2 vCPU, 8 GB RAM, 40 GB SSD)
- –†–∞–±–æ—á–∏–µ —É–∑–ª—ã: 3√ó s3-c4-m16 (4 vCPU, 16 GB RAM, 128 GB SSD)

### –°–µ—Ç–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –í—ã–¥–µ–ª–µ–Ω–Ω–∞—è VPC —Å–µ—Ç—å
- NAT-—à–ª—é–∑ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ
- Apache Spark
- Apache Hadoop
- Jupyter Notebook
- Python 3

## üìä –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É
```bash
ssh -o StrictHostKeyChecking=no ubuntu@<master-node-ip>
```

### –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ S3 –≤ HDFS
```bash
hadoop distcp \
  -D fs.s3a.access.key=$TF_VAR_s3_access_key \
  -D fs.s3a.secret.key=$TF_VAR_s3_secret_key \
  -D fs.s3a.endpoint=storage.yandexcloud.net \
  -D dfs.replication=1 \
  -D dfs.blocksize=128m \
  -D mapreduce.job.maps=10 \
  -D mapreduce.map.memory.mb=2048 \
  -D mapreduce.map.java.opts=-Xmx1536m \
  -D dfs.client.use.datanode.hostname=true \
  -update -log /tmp/distcp_log \
  s3a://$TF_VAR_bucket_name/* \
  hdfs:///user/ubuntu/data/
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ HDFS

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è, –º—ã –º–æ–∂–µ–º —É–≤–∏–¥–µ—Ç—å —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ HDFS:

```bash
hdfs dfs -ls /user/ubuntu/data/
```

–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ HDFS:
- –í—Å–µ–≥–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ 40 —Ñ–∞–π–ª–æ–≤
- –î–∞–Ω–Ω—ã–µ –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å –∞–≤–≥—É—Å—Ç–∞ 2019 –ø–æ –Ω–æ—è–±—Ä—å 2022
- –í—Å–µ —Ñ–∞–π–ª—ã –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ubuntu
- –†–∞–∑–º–µ—Ä –±–ª–æ–∫–æ–≤ –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∑–∞–¥–∞–Ω–Ω—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º

![–†–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö]

![copy_rez](https://github.com/user-attachments/assets/67c22d58-2d3c-4900-8a25-44738c86dd91)


## üßπ –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤

–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

1. –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞:
```bash
cd create_spark
terraform destroy
```

2. –£–¥–∞–ª–µ–Ω–∏–µ S3 –±–∞–∫–µ—Ç–∞:
```bash
cd ../create-bucket
terraform destroy
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
- –í—Å–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—Å—è –≤ git
- –ö–ª—é—á–∏ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏–Ω—Ü–∏–ø –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

### –°–µ—Ç–µ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ö–ª–∞—Å—Ç–µ—Ä —Ä–∞–∑–º–µ—â–µ–Ω –≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–π –ø–æ–¥—Å–µ—Ç–∏
- –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ SSH
- –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã security groups

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

[MIT](LICENSE)
